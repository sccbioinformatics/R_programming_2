# Packages
We have have a few functions in our back pocket now, but before we carry on making more functions it makes sense to start thinking about making an R package to contain an document all of our functions. Our package will be pushed up to Github where it will be available to use by you, and anyone else in the world. This is how Seurat was made available in the early days before it was officially submitted to CRAN.

Making an R package was something of a pain in the early days, but now things like Rstudio make it much easier by providing the skeleton of a package that you can use as a template.

## Start a new package

1. Open a new Rstudio window/session and go to "New Project" > "New Directory" > "R Package"

2. Type in the name you want to give the package (I'll call mine "SCAP", Single-cell Anaysis Package), and tell Rstudio where you want this project folder to be created.

Rstudio will make the folder and change you session directory to it.

3. Go to Github and make a new repository. Give it the same name as your package name.

4. When you create the repo you will see some lines of code to perform your first push. In my case:

```{bash, eval=F}
$ echo "# SCAP" >> README.md
$ git init
$ git add DESCRIPTION  man  NAMESPACE  R  README.md  SCAP.Rproj .Rbuildignore
$ git commit -m "first commit"
$ git branch -M main
$ git remote add origin git@github.com:shambam/SCAP.git
$ git push -u origin main
```

5. Open a terminal and navigate to your project folder and execute these lines. **Don't forget to swap "shambam" with your own Github ID**.

6. Once you have done this you are ready to push you package up to Github as you create it.

If you run `git status` in your newly created directory you will see the `.Rproj.user` directory, marked as "untracked". You shouldn't push this directory as it only contains user specific settings, and we don't want to override anyone else's settings if they choose to clone our project. This is a prime example of why you should never use `git add .`. If we don't want to accidentally include this file in any future commit, we can add it to a file called `.gitignore`. Go ahead and create this file using

```{bash, eval=F}
$ echo ".Rproj.user" > .gitignore
```

You can add any future files or directories you don't want to include in commits by adding them to this file, one item per line. Go ahead and add the `.gitignore` file as well to a new commit and run `git status` to make sure `.Rproj.user` doesn't pop up there anymore. As a small bonus exercise; what happens if you run `git add .Rproj.user` when it is in our `.gitignore`?

## The anatomy of a package

You will see a few files and folders in your package directory. The important ones are:

1. **DESCRIPTION** This file is where you add details about your package and what the package does. Take a moment to fill out some of the details. When you save the file, it will appear in the "Git" window (top right pane). If you want to push this file to Github you can check the box next to the file and hit "commit". A window will open showing when in the file has changed, and in the top right you can write a commit message. Write a commit message and then commit the file. You will go back to the main window where you can push the file using the upward pointing green arrow.

**You don't have to do this every time you change a file.**

2. **R** This folder is where your code goes. In the files pane (bottom right) click into the folder and open hello.R. You can see it's a very simple function that prints ""Hello, world!" when called. Let install this simple package. In the the build tab click the install button.

The package will install and your `SCAP` library will automatically be called. In the terminal do:

```{r,eval=F}
hello()
```

Do this:

```{r}
?hello
```

This will open a help page. The help file comes from `man/hello.Rd`, but we don't actually want to use this "hand  written" file. We want the help pages to be generated automatically as we write our package, so delete this file and go back to `hello.R` and change it so it looks like this:

```
#' A header line for your package
#' @name hello
#' @description A simple function that prints a welcome
#` @return Prints "Hello, world!"`
#' @examples
#' hello()
#' @export

hello <- function() {
  print("Hello, world!")
}
```

Before we can build the documentation we need to install the package that will do it. **Note**, you may need to install the `stringi` package first, but see if it works without first!

```{r, eval=F}
install.packages("roxygen2")
```

Go to "More" > "Configure Build Tools..." and check the box that says "Generate documentation with Roxygen". At the bottom check "Install and restart". Now when you install the package Rstudio will automatically generate the hello.Rd file from the lines of documentation you have written above.

This is great because all the documentation is kept in the same file as the code which means both can be written together easily.

## Adding dependencies.
Dependencies are other packages that your own package needs to function. For example, to make the QC plots you'll need the `ggplot2` library. To add this, open the DESCRIPTION file.

You add a package by making an imports section:

```
Package: SCAP
Type: Package
Title: Single-cell Analysis Package
Version: 0.1.0
Author: Shamit Soneji
Maintainer: Shamit Soneji <shamit.soneji@med.lu.se>
Description: A dummy package
License: None
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.2.3
Imports:
  ggplot2,
  dplyr
```

When these are used in your code the libraries are called. Another cool safeguard is to do the following:

```
Package: SCAP
Type: Package
Title: Single-cell Analysis Package
Version: 0.1.0
Author: Shamit Soneji
Maintainer: Shamit Soneji <shamit.soneji@med.lu.se>
Description: A dummy package
License: None
Encoding: UTF-8
LazyData: true
RoxygenNote: 7.2.3
Depends:
    R (>= 4.0.0)
Imports:
  ggplot2,
  dplyr
```
By adding this you ensure  that whoever is installing it has at least version 4 or R or higher. If they don't then it won't install. Be nice, if your pacakge is simple then omit this so as many people as possible can use it.

Now that we have the basics of what we need, we can start to "transplant" some of our code into a package.


